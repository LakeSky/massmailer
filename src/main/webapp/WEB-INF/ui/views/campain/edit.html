
<div ng-controller="CampainEditController">
    <div class="modal-header">
        <h3 style="">Kampaň (email)</h3>
    </div>
    <div class="modal-body container">
        <form  class="form-horizontal" ng-submit="save()" name="campainForm"   >
            <div class="row">
                <div class="col-md-6">
                    <input type="hidden" ng-model="Campain.id" interpol-model="id" server-error="id" name="id"/>
                    <div class="form-group">
                        <label  class="control-label col-sm-3" for="campainName">Název</label>
                        <div class="col-sm-9" >
                            <input  class="form-control input-sm" type="text" id = "campainName" name="campainName" ng-model="Campain.campainName"  interpol-model="campainName" server-error="campainName"/>
                            <div class="errors"  show-inter="campainName" >
                                <error-message error="campainName" ></error-message>   
                            </div>
                        </div>
                    </div>  


                    <div class="form-group">
                        <label class="control-label col-sm-3"  for="recipients">Adresát</label>
                        <div class="col-sm-9">
                            <input typeahead-editable="false" ng-disabled="datasourceSelected === undefined || datasourceSelected === null || datasourceSelected === ''"  typeahead="field for field in getEmailFields($viewValue) | filter:$viewValue" class="form-control input-sm" type="text" id = "recipients" name="recipients" ng-model="Campain.recipients"  interpol-model="recipients" server-error="recipients"/>

                            <div class="errors"  show-inter="recipients" >
                                <error-message error="recipients" ></error-message>   
                            </div>
                        </div>
                    </div>  


                </div>
                <div class="col-md-6">

                    <div class="form-group">
                        <input class="form-control"  type="hidden" id = "dataSourceId" name="dataSourceId" ng-model="Campain.dataSourceId"  interpol-model="dataSourceId" server-error="dataSourceId"/>
                        <label  class="control-label col-sm-3" for="datasourceSelected">Datový zdroj</label>
                        <div class="col-sm-9">
                            <input type="text" ng-model="datasourceSelected" placeholder="Vyhledat datový zdroj" typeahead-loading="loadingLocations"  typeahead="datasource as datasource.name for datasource in searchDataSources($viewValue) | filter:{name: $viewValue}"  typeahead-on-select="onDatasourceSelected($item)" class="form-control input-sm">
                            <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i>
                            <div class="errors"  show-inter="dataSourceId" >
                                <error-message error="dataSourceId" ></error-message>   
                            </div>
                        </div>

                    </div>  

                    <div class="form-group">
                        <label class="control-label col-sm-3"  for="bccRecipients">Adresát kopie</label>
                        <div class="col-sm-9">
                            <input typeahead-editable="false" ng-disabled="datasourceSelected === undefined || datasourceSelected === null || datasourceSelected === ''"  typeahead="field for field in getEmailFields($viewValue) | filter:$viewValue" c  class="form-control input-sm" type="text" id = "bccRecipients" name="bccRecipients" ng-model="Campain.bccRecipients"  interpol-model="bccRecipients" server-error="bccRecipients"/>
                            <div class="errors"  show-inter="bccRecipients" >
                                <error-message error="bccRecipients" ></error-message>   
                            </div>
                        </div>
                    </div>  


                </div>
            </div>
            <tabset justified="true">
                <tab>

                    <tab-heading>
                        <i class="glyphicon glyphicon-envelope"></i> Tělo emailu
                    </tab-heading>
                    <div class="container">
                        <div class="row" style="padding-top: 1em">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label class="control-label col-sm-3"   for="recipients">Předmět</label>
                                    <div class="col-sm-9">
                                        <input  class="form-control inpsmut-sm" type="text" id = "subject" name="subject" ng-model="Campain.subject"  interpol-model="subject" server-error="subject"/>
                                        <div class="errors"  show-inter="subject" >
                                            <error-message error="subject" ></error-message>   
                                        </div>
                                    </div>
                                </div> 
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <textarea cols="60" id="rr" rows="30"  class="ckeditor" style="width: 800px;height: 300px; z-index: 100;" ng-model="Campain.emailText" >
               
                                </textarea>
                            </div>
                            <div class="col-md-4">

                                <h4 style="margin-top: 0;">Dostupné proměné</h4>
                                <p ng-repeat="f in datasourceSelected.dataStructure.dataStructureFields">

                                    ###{{f.name}}###
                                </p>

                            </div>
                        </div>
                    </div>
                </tab>
                <tab>
                    <tab-heading>
                        <i class="glyphicon glyphicon-paperclip"></i>Příloha
                    </tab-heading>







                    <div class="container">
                        <div class="row" style="padding-top: 1em">
                            <div class="col-md-6">

                                <div class="form-group">
                                    <label class="control-label col-sm-3"   for="attachmentOutputName">Název přílohy</label>
                                    <div class="col-sm-9">
                                        <input  class="form-control input-sm" type="text" id = "attachmentOutputName" name="attachmentOutputName" ng-model="Campain.attachmentOutputName"  interpol-model="attachmentOutputName" server-error="attachmentOutputName"/>
                                        <div class="errors"  show-inter="attachmentOutputName" >
                                            <error-message error="attachmentOutputName" ></error-message>   
                                        </div>
                                    </div>
                                </div> 

                            </div>
                        </div>



                        <div class="row">
                            <div class="row">
                                <div class="col-md-1">
                                    <div class="btn-group text-left">
                                        <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">Typ náhledu<span class="caret"></span>
                                        </button>

                                        <ul class="dropdown-menu" >
                                            <li><a ng-click="toglePreviewType('pdf')"  >pdf</a></li>
                                            <li><a ng-click="toglePreviewType('html')"  >html</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <pre class="input-sm"> {{previewType}}</pre>
                                </div>
                            </div>
                            <iframe class="col-md-7" ng-src="{{templateUrl}}"    height="400px" >
                            </iframe>
                            <div class="col-md-5">
                                <pre>            
Název souboru: {{ Campain.attachmentName}}
 <br/>
 Typ souboru: {{ Campain.attachmentFileType}} 
                                </pre>
                                <div class="form-group">
                                    <label class="control-label col-sm-4"  for="customizeAttachments">Nahrát soubor</label>
                                    <div class="col-sm-8">
                                        <input type="file" ng-model="files" file-change id="file" >
                                    </div>
                                </div>  



                                <div ng-show="loadingfile">
                                    <img src="img/ajax-loader.gif" width="220" height="19" alt="ajax-loader"/>
                                </div>

                                <div class="form-group">
                                    <label class="control-label col-sm-4"  for="customizeAttachments">Přizpůsobit přílohu</label>
                                    <div class="col-sm-8">
                                        <input  class="input-sm" ng-disabled="Campain.attachmentFileSystemName === undefined || Campain.attachmentFileSystemName === null" type="checkbox" ng-change="customizeAttachment()" id = "customizeAttachments" name="customizeAttachments" ng-model="Campain.customizeAttachments"  interpol-model="customizeAttachments" server-error="customizeAttachments"/>
                                        <div class="errors"  show-inter="customizeAttachments" >
                                            <error-message error="customizeAttachments" ></error-message>   
                                        </div>
                                    </div>
                                </div>  

                                <div class="form-group">
                                    <input  class="form-control" type="hidden" id = "attachmentFileSystemName" name="attachmentFileSystemName" ng-model="Campain.attachmentFileSystemName" />
                                    <input  class="form-control" type="hidden" id = "attachmentName" name="attachmentName" ng-model="Campain.attachmentName" />
                                    <input  class="form-control" type="hidden" id = "attachmentType" name="attachmentType" ng-model="Campain.attachmentType" />
                                </div> 



                                <div class="col-sm-6">
                                    <h4 style="margin-top: 0;">Použadované proměné</h4>
                                    <p ng-repeat="f in templateFields">
                                        ###{{f}}### 
                                    </p>
                                </div>
                                <div class="col-md-6">

                                    <h4 style="margin-top: 0;">Dostupné proměné</h4>
                                    <p ng-repeat="f in datasourceSelected.dataStructure.dataStructureFields">

                                        ###{{f.name}}###
                                    </p>

                                </div>
                            </div>
                        </div>
                    </div>

                </tab>
            </tabset>

        </form>
    </div>



    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok()">OK</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
    <script src="js/ckeditor/ckeditor.js"></script>


</div>
